{% extends "base.html" %}
{% load static %}
{% load matman_tags %}
{% load crispy_forms_tags %}

{% block title %}Material{% endblock %}

{% block scripts %}
<script type="text/javascript" src="{% static "js/autocomplete.js" %}"></script>
<link href="{% static "css/autocomplete.css" %}" rel="stylesheet">
<script defer>
    window.onload = function() {
        suggest_tags(document.getElementById("id_tags__name"));
    };
</script>
{% endblock %}

{% block content %}
<h1>Materials</h1>
<p>
    <a href="{% url "add-material" %}" class="btn btn-outline-primary" aria-current="page">
        <svg class="bi flex-1" role="img" aria-label="Info:"><use xlink:href="#plus"/></svg>
        Add Material
    </a>
</p>
<div class="accordion" id="accordionExample">
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingOne">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
        Filters
      </button>
    </h2>
    <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
      <div class="accordion-body">
        <form method="get">
          {% csrf_token %}
          {{ filterset.form|crispy }}
          <input type="submit" value="Search" class="btn btn-primary">
        </form>
      </div>
    </div>
  </div>
</div>

<table class="table table-striped table-hover">
    <tr>
        <th>ID</th>
        <th>Serial Number</th>
        <th>Material Number</th>
        <th>Manufacturer</th>
        <th>Department</th>
        <th>Location</th>
        <th>Owner</th>
        <th>Tags</th>
        <th></th>
    </tr>
    {% for object in object_list %}
    <tr>
        <th><a href="{% url "material-detail" object.identifier %}">{{ object.identifier }}</a></th>
        <td>{{ object.serial_number }}</td>
        <td>{{ object.material_number }}</td>
        <td>{{ object.manufacturer }}</td>
        <td>{{ object.department }}</td>
        <td>{{ object.location }}</td>
        <td><a href="{% url "profile" object.owner %}">{{ object.owner }}</a></td>
        <td>{{ object.tags.all|join:", " }}</td>
        <td class="d-flex flex-row">
            <div class="dropdown p-1">
                <button class="btn btn-outline-secondary p-1" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <svg class="bi flex-shrink-0" role="img" aria-label="Info:"><use xlink:href="#three-dots"/></svg>
                </button>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="{% url "material-edit" object.identifier %}">Edit</a></li>
                  <li><a class="dropdown-item" href="{% url "add-material" %}?reference={{ object.identifier }}">Copy/Clone</a></li>
                </ul>
            </div>
            {% if user.is_authenticated %}
            {% if object in bookmarked %}
            <button class="btn btn-outline-secondary p-1" type="button" title="Unbookmark" value="{{ object.identifier }}" id="id_button_bookmark_{{ object.identifier }}" onclick="toggle_bookmark(this)">
                <svg class="bi flex-shrink-0" role="img" aria-label="Info:"><use xlink:href="#bookmark-check-fill"/></svg>
            </button>
            {% else %}
            <button class="btn btn-outline-secondary p-1" type="button" title="Bookmark" value="{{ object.identifier }}" id="id_button_bookmark_{{ object.identifier }}" onclick="toggle_bookmark(this)">
                <svg class="bi flex-shrink-0" role="img" aria-label="Info:"><use xlink:href="#bookmark"/></svg>
            </button>
            {% endif %}
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>
{% include "pagination.html" with page_param="page" %}
{% endblock %}