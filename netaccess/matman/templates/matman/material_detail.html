{% extends "base.html" %}
{% load static %}
{% load matman_tags %}
{% load crispy_forms_tags %}

{% block title %}Material Details{% endblock %}

{% block scripts %}
<script type="text/javascript" src="{% static "js/autocomplete.js" %}"></script>
<link href="{% static "css/autocomplete.css" %}" rel="stylesheet">
{% init_mde "id_text" %}
{% endblock %}

{% block content %}
{% with borrow=object.get_active_borrow %}
<h1>{{ object }}</h1>
<!--    Buttons    -->
<section class="btn-group" role="group" aria-label="Basic example"">
    {% if not object.get_active_borrow and object.is_active %}
    <a class="btn btn-outline-primary" href="{% url "borrow" object.identifier %}">
        <svg class="bi flex-shrink-0" role="img" aria-label="Info:"><use xlink:href="#symbol-borrow"/></svg>
        <span>Borrow</span>
    </a>
    {% endif %}
    <a class="btn btn-outline-primary" href="{% url "material-edit" object.identifier %}">
        <svg class="bi flex-shrink-0" role="img" aria-label="Info:"><use xlink:href="#edit"/></svg>
        <spa>Edit</spa>
    </a>
    {% if object.get_active_borrow %}
    <a class="btn btn-outline-primary" href="{% url "return" object.get_active_borrow.pk %}">
        <svg class="bi flex-shrink-0" role="img" aria-label="Info:"><use xlink:href="#symbol-undo"/></svg>
        <spa>Return Item</spa>
    </a>
    {% endif %}
    <a class="btn btn-outline-primary" href="{% url "add-material" %}?reference={{ object.identifier }}">
        <svg class="bi flex-shrink-0" role="img" aria-label="Info:"><use xlink:href="#clone"/></svg>
        <spa>Copy/Clone</spa>
    </a>
    {% if user.is_authenticated %}
    {% if is_bookmarked %}
    <button class="btn btn-outline-primary" type="button" title="Bookmarked" value="{{ object.identifier }}" id="id_button_bookmark_{{ object.identifier }}" onclick="toggle_bookmark(this)">
        <svg class="bi flex-shrink-0" role="img" aria-label="Info:"><use xlink:href="#bookmark-check-fill"/></svg>
        <span class="text">Bookmarked</span>
    </button>
    {% else %}
    <button class="btn btn-outline-primary" type="button" title="Bookmark" value="{{ object.identifier }}" id="id_button_bookmark_{{ object.identifier }}" onclick="toggle_bookmark(this)">
        <svg class="bi flex-shrink-0" role="img" aria-label="Info:"><use xlink:href="#bookmark"/></svg>
        <span class="text">Bookmark</span>
    </button>
    {% endif %}
    {% endif %}
</section>
<section>
    <!--    Details Table    -->
    <table class="table table-striped table-hover d-inline-flex my-3">
        <tr>
            <th>Serial Number:</th>
            <td>{{ object.serial_number }}</td>
        </tr>
        <tr>
            <th>Material Number:</th>
            <td>{{ object.part_number }}</td>
        </tr>
        <tr>
            <th>Manufacturer:</th>
            <td>{{ object.manufacturer }}</td>
        </tr>
        <tr>
            <th>Location:</th>
            <td>{{ object.location }}</td>
        </tr>
        <tr>
            <th>Owner:</th>
            <td><a href="{% url "profile" object.owner %}">{{ object.owner }}</a></td>
        </tr>
        <tr>
            <th>Tags:</th>
            <td>
                {% for tag in object.tags.all %}
                <a href="{% url "list-material" %}?tags__name={{ tag }}" class="badge text-bg-light">{{ tag }}</a>
                {% endfor %}
            </td>
        </tr>
        <tr>
            <th>Active:</th>
            <td>{{ object.is_active }}</td>
        </tr>
        <tr>
            <th>Borrowed by:</th>
            {% if borrow %}
            <td><a href="{% url "profile" borrow.borrowed_by %}">{{ borrow.borrowed_by }}</a></td>
            {% else %}
            <td></td>
            {% endif %}
        </tr>
        <tr>
            <th>Borrowed since:</th>
            <td>{{ object.get_active_borrow.borrowed_at|date }}</td>
        </tr>
    </table>

    <!--    Description    -->
    <h4>Description</h4>
    <div class="border border-dark rounded">
        {% if object.description %}
        {{ object.description|markdown }}
        {% else %}
        No description available.
        {% endif %}
    </div>

    <!--    Pictures    -->
    {% if object.pictures.all %}
    {% include "matman/slideshow.html" with pictures=object.pictures %}
    {% endif %}

    <!--    Comments and Borrows in chronological order    -->
    <h4>Comments & Borrows</h4>
    {% for cb in comments_borrows %}
    {% if cb.type == "comment" %}
    {% include "matman/comment.html" with comment=cb.object %}
    {% else %}
    {% include "matman/borrow_toast.html" with borrow=cb.object %}
    {% endif %}
    {% endfor %}

    <h2>Add Comment</h2>
    {% crispy comment_form %}
{% endwith %}
{% endblock %}