{% extends "base.html" %}
{% load matman_tags %}
{% load crispy_forms_tags %}

{% block title %}Material Details{% endblock %}

{% block scripts %}
{% init_mde "id_text" %}
{% endblock %}

{% block content %}
{% with borrow=object.get_active_borrow %}
<h1>{{ object }}</h1>
<section>

    <!--    Buttons    -->
    <div class="d-flex">
        <a class="btn btn-secondary m-1" href="{% url "material-edit" object.identifier %}">Edit</a>
        {% if not object.get_active_borrow %}
        <a class="btn btn-primary m-1" href="{% url "borrow" object.identifier %}">Borrow Item</a>
        {% endif %}
        {% if object.get_active_borrow %}
        <a class="btn btn-primary m-1" href="{% url "return" object.get_active_borrow.pk %}">Return Item</a>
        {% endif %}
        <a class="btn btn-outline-secondary m-1" href="{% url "add-material" %}?reference={{ object.identifier }}">Copy/Clone</a>
    </div>

    <!--    Details Table    -->
    <table class="table table-striped table-hover d-inline-flex my-3">
        <tr>
            <th>Serial Number:</th>
            <td>{{ object.serial_number }}</td>
        </tr>
        <tr>
            <th>Material Number:</th>
            <td>{{ object.material_number }}</td>
        </tr>
        <tr>
            <th>Manufacturer:</th>
            <td>{{ object.manufacturer }}</td>
        </tr>
        <tr>
            <th>Location:</th>
            <td>{{ object.location }}</td>
        </tr>
        <tr>
            <th>Owner:</th>
            <td><a href="{% url "profile" object.owner %}">{{ object.owner }}</a></td>
        </tr>
        <tr>
            <th>Tags:</th>
            <td>{{ object.tags.all|join:", " }}</td>
        </tr>
        <tr>
            <th>Active:</th>
            <td>{{ object.is_active }}</td>
        </tr>
        <tr>
            <th>Borrowed by:</th>
            {% if borrow %}
            <td><a href="{% url "profile" borrow.borrowed_by %}">{{ borrow.borrowed_by }}</a></td>
            {% else %}
            <td></td>
            {% endif %}
        </tr>
        <tr>
            <th>Borrowed at:</th>
            <td>{{ object.get_active_borrow.borrowed_at|date }}</td>
        </tr>
    </table>

    <!--    Description    -->
    <h4>Description</h4>
    <div class="border border-dark rounded">
        {% if object.description %}
        {{ object.description|markdown }}
        {% else %}
        No description available.
        {% endif %}
    </div>

    <!--    Pictures    -->
    {% if object.pictures.all %}
    {% include "matman/slideshow.html" with pictures=object.pictures %}
    {% endif %}

    <!--    Comments and Borrows in chronological order    -->
    <h4>Comments & Borrows</h4>
    {% for cb in comments_borrows %}
    {% if cb.type == "comment" %}
    {% include "matman/comment.html" with comment=cb.object %}
    {% else %}
    {% include "matman/borrow_toast.html" with borrow=cb.object %}
    {% endif %}
    {% endfor %}

    {% crispy comment_form %}
{% endwith %}
{% endblock %}